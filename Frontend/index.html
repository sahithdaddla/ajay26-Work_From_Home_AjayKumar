
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work From Home Request</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6b46c1; 
            --primary-light: #a68de8; 
            --primary-dark: #553c9a;
            --success: #38a169; 
            --warning: #ed8936;
            --error: #e53e3e;
            --dark: #2d3748; 
            --light: #f7fafc; 
            --lighter: #ffffff; 
            --gray: #718096;
            --gray-light: #e2e8f0;
            --accent: #3182ce;
            --accent-light: #63b3ed; 
            --glass-bg: rgba(255, 255, 255, 0.9);
            --glass-blur: blur(10px);
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
            --border-radius: 8px;
            --border-radius-lg: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: white;
            color: black;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        header {
            width: 100%;
            max-width: 1400px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: var(--lighter);
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 2;
        }

        header p {
            font-size: 1rem;
            opacity: 0.85;
            position: relative;
            z-index: 2;
        }

        .banner-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            overflow: hidden;
        }

        .circle {
            position: absolute;
            width: 180px;
            height: 180px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            animation: moveCircles 12s infinite ease-in-out;
        }

        .circle:nth-child(1) {
            top: 15%;
            left: 25%;
            animation-duration: 10s;
        }

        .circle:nth-child(2) {
            top: 55%;
            left: 65%;
            animation-duration: 14s;
        }

        .circle:nth-child(3) {
            top: 75%;
            left: 35%;
            animation-duration: 16s;
        }

        @keyframes moveCircles {
            0% { transform: translate(0, 0); }
            50% { transform: translate(-40%, -40%); }
            100% { transform: translate(0, 0); }
        }

        .filter-container {
            width: 100%;
            max-width: 1400px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.25);
        }

        .filter-left {
            display: flex;
            gap: 1rem;
        }

        .filter-left select {
            padding: 0.5rem 1rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            background: var(--lighter);
            transition: var(--transition);
            color: var(--dark);
        }

        .filter-left select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.15);
        }

        .filter-right .btn-primary {
            background: var(--accent);
            color: var(--lighter);
            padding: 0.5rem 1rem;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border-radius: var(--border-radius);
        }

        .filter-right .btn-primary:hover {
            background: var(--accent-light);
            color: var(--dark);
            transform: translateY(-1px);
        }

        .form-container {
            width: 100%;
            max-width: 1400px;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            display: none;
        }

        .form-container.show {
            display: block;
        }

        .form-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .wfh-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-row {
            display: flex;
            gap: 1rem;
        }

        .form-col {
            flex: 1;
        }

        .form-group {
            position: relative;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        input, textarea {
            width: 100%;
            padding: 1rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            transition: var(--transition);
            background: var(--lighter);
            color: var(--dark);
        }

        textarea {
            resize: none;
            height: 120px;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.15);
        }

        .error-message {
            color: var(--error);
            font-size: 0.8rem;
            margin-top: 0.25rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .submit-container {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--accent);
            color: var(--lighter);
        }

        .btn-primary:hover {
            background: var(--accent-light);
            color: var(--dark);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--gray-light);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: var(--gray);
            color: var(--lighter);
        }

        .main-container {
            width: 100%;
            max-width: 1400px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .requests-container {
            background: var(--lighter);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            height: 100vh;
            overflow-y: auto;
        }

        .requests-container h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .request-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: var(--border-radius);
            background: linear-gradient(135deg, #edf2f7, #f7fafc);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .request-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .request-type {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            color: var(--primary);
        }

        .request-dates {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .request-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-pending {
            background: #fefcbf;
            color: #d69e2e;
        }

        .status-approved {
            background: #c6f6d5;
            color: #2f855a;
        }

        .status-rejected {
            background: #fed7d7;
            color: #c53030;
        }

        .view-link {
            color: var(--accent);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
        }

        .view-link:hover {
            color: var(--accent-light);
            text-decoration: underline;
        }

        .no-data {
            text-align: center;
            padding: 2rem;
            color: var(--gray);
        }

        .no-data span {
            font-size: 2rem;
            margin-bottom: 1rem;
            display: block;
        }

        .right-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .calendar-container {
            background: linear-gradient(135deg, #e9d8fd, #f7fafc);
            border-radius: var(--border-radius-lg);
            padding: 1.25rem;
            box-shadow: var(--shadow);
            height: 60vh;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: auto;
            margin-right: auto;
        }

        .calendar-nav button {
            background: var(--lighter);
            border: none;
            font-size: 1rem;
            cursor: pointer;
            color: var(--dark);
            padding: 0.5rem;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .calendar-nav button:hover {
            background: var(--gray-light);
        }

        .calendar-month {
            font-weight: 600;
            min-width: 8rem;
            text-align: center;
            color: var(--primary);
            font-size: 1.2rem;
        }

        .calendar {
            width: 100%;
            background: var(--lighter);
            border-radius: var(--border-radius);
            padding: 0.75rem;
        }

        .calendar .header {
            display: flex;
            justify-content: space-between;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: rgb(2, 2, 117);
        }

        .calendar .header span {
            flex: 1;
            text-align: center;
            font-size: 0.85rem;
        }

        .calendar .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .calendar .day {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 2rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            color: var(--dark);
            position: relative;
            font-size: 0.9rem;
        }

        .calendar .day:hover {
            background: var(--gray-light);
        }

        .calendar .day.wfh {
            color: var(--success);
        }

        .calendar .day.holiday {
            color: var(--warning);
        }

        .calendar .day.today {
            color: var(--accent);
            font-weight: 600;
        }

        .calendar .day.other-month {
            color: var(--gray);
            opacity: 0.4;
        }

        .calendar .day[data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            top: -2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: var(--lighter);
            padding: 0.25rem 0.5rem;
            border-radius: var(--border-radius);
            font-size: 0.75rem;
            white-space: nowrap;
            z-index: 10;
        }

        .summary-container {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            height: 35vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .summary-container h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .summary-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1rem;
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 0.75rem;
        }

        .summary-item span.emoji {
            font-size: 1.2rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--lighter);
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            max-width: 600px;
            width: 90%;
            box-shadow: var(--shadow);
            position: relative;
            animation: slideIn 0.3s ease;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.2rem;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--error);
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .detail-modal-content {
            padding: 1.5rem;
            max-height: 80vh;
            overflow-y: auto;
        }

        .detail-modal-content h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .detail-modal-content p {
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--dark);
        }

        .detail-modal-content p span.emoji {
            font-size: 1rem;
        }

        .confirmation-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(4px);
        }

        .confirmation-animation.show {
            opacity: 1;
            pointer-events: auto;
        }

        .confirmation-content {
            background: var(--lighter);
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            text-align: center;
            max-width: 400px;
            transform: scale(0.8);
            transition: transform 0.3s ease;
            box-shadow: var(--shadow);
        }

        .confirmation-animation.show .confirmation-content {
            transform: scale(1);
        }

        .confirmation-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .confirmation-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .confirmation-message {
            margin-bottom: 1rem;
            color: var(--gray);
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .confirmation-button {
            background: var(--accent);
            color: var(--lighter);
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            width: 100%;
        }

        .confirmation-button:hover {
            background: var(--accent-light);
            color: var(--dark);
            transform: translateY(-1px);
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1rem;
        }

        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
            }

            .calendar-container {
                height: 50vh;
            }

            .summary-container {
                height: auto;
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            .filter-container {
                flex-direction: column;
                gap: 1rem;
            }

            .filter-left {
                flex-direction: column;
                width: 100%;
            }

            .filter-left select {
                width: 100%;
            }

            .calendar-container {
                height: 40vh;
            }

            .calendar .day {
                height: 1.75rem;
                font-size: 0.8rem;
            }

            .form-row {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            header h1 {
                font-size: 1.5rem;
            }

            .calendar-header {
                flex-direction: column;
                gap: 0.5rem;
                align-items: flex-start;
            }

            .calendar-nav {
                width: 100%;
                justify-content: space-between;
            }

            .calendar-month {
                min-width: auto;
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="banner-background">
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="circle"></div>
        </div>
        <h1>üè† Work From Home Request</h1>
        <p>Manage your remote work requests efficiently</p>
    </header>

    <div class="filter-container">
        <div class="filter-left">
            <select id="monthFilter">
                <option value="">All Months</option>
                <option value="0">January</option>
                <option value="1">February</option>
                <option value="2">March</option>
                <option value="3">April</option>
                <option value="4">May</option>
                <option value="5">June</option>
                <option value="6">July</option>
                <option value="7">August</option>
                <option value="8">September</option>
                <option value="9">October</option>
                <option value="10">November</option>
                <option value="11">December</option>
            </select>
            <select id="yearFilter">
                <option value="">All Years</option>
                <option value="2023">2023</option>
                <option value="2024">2024</option>
                <option value="2025">2025</option>
            </select>
        </div>
        <div class="filter-right">
            <button class="btn btn-primary" id="applyWFH">üè† Apply WFH Request</button>
        </div>
    </div>

    <div class="form-container" id="wfhFormContainer">
        <h2 class="form-title">üè† WFH Request Form</h2>
        <form id="wfhForm" class="wfh-form" onsubmit="return false" novalidate>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="employeeName">üë§ Employee Name</label>
                        <input type="text" id="employeeName" placeholder="Enter your name" required minlength="3" maxlength="100">
                        <p class="error-message" id="employeeNameError"></p>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="employeeID">ü™™ Employee ID</label>
                        <input type="text" id="employeeID" placeholder="ATS0xxx" required minlength="7" maxlength="7">
                        <p class="error-message" id="employeeIDError"></p>
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="employeeEmail">üìß Email</label>
                        <input type="email" id="employeeEmail" placeholder="your.name@astrolitetech.com" required minlength="3" maxlength="100" onkeypress="return (event.charCode != 32)">
                        <p class="error-message" id="employeeEmailError"></p>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="workingProject">üìà Project</label>
                        <input type="text" id="workingProject" placeholder="Project name" required minlength="3" maxlength="40">
                        <p class="error-message" id="workingProjectError"></p>
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="reportingManager">üë®‚Äçüíº Manager</label>
                        <input type="text" id="reportingManager" placeholder="Manager name" required minlength="3" maxlength="40">
                        <p class="error-message" id="reportingManagerError"></p>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="wfhLocation">üìç Location</label>
                        <input type="text" id="wfhLocation" placeholder="Your location" required minlength="3" maxlength="100">
                        <p class="error-message" id="wfhLocationError"></p>
                    </div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="fromDate">üìÖ From Date</label>
                        <input type="date" id="fromDate" required>
                        <p class="error-message" id="fromDateError"></p>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="toDate">üìÖ To Date</label>
                        <input type="date" id="toDate" required>
                        <p class="error-message" id="toDateError"></p>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="reason">üí¨ Reason</label>
                <textarea id="reason" placeholder="Reason for WFH request..." required minlength="10" maxlength="200"></textarea>
                <p class="error-message" id="reasonError"></p>
            </div>
            <div class="submit-container">
                <button type="button" class="btn btn-secondary" id="cancelFormBtn">Cancel</button>
                <button type="submit" class="btn btn-primary">‚úàÔ∏è Submit Request</button>
            </div>
        </form>
    </div>

    <div class="main-container">
        <div class="requests-container">
            <h2>üìã My Requests</h2>
            <div id="requestsList"></div>
        </div>
        <div class="right-container">
            <div class="calendar-container">
                <div class="calendar-header">
                    <div class="calendar-nav">
                        <button id="prevMonth">‚¨ÖÔ∏è</button>
                        <div class="calendar-month" id="currentMonthYear"></div>
                        <button id="nextMonth">‚û°Ô∏è</button>
                    </div>
                </div>
                <div class="calendar">
                    <div class="header">
                        <span>Sun</span>
                        <span>Mon</span>
                        <span>Tue</span>
                        <span>Wed</span>
                        <span>Thu</span>
                        <span>Fri</span>
                        <span>Sat</span>
                    </div>
                    <div class="days" id="calendarDays"></div>
                </div>
            </div>
            <div class="summary-container">
                <h2>üìä WFH Summary</h2>
                <div id="wfhSummary"></div>
            </div>
        </div>
    </div>

    <div class="modal" id="detailModal">
        <div class="modal-content detail-modal-content">
            <span class="modal-close" id="detailModalClose">‚ùå</span>
            <div id="requestDetails"></div>
        </div>
    </div>

    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>Confirm Submission</span>
                <span class="modal-close" id="confirmModalClose">‚ùå</span>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to submit this WFH request?</p>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelSubmitBtn">Cancel</button>
                <button class="btn btn-primary" id="confirmSubmitBtn">‚úÖ Confirm</button>
            </div>
        </div>
    </div>

    <div class="confirmation-animation" id="confirmationAnimation">
        <div class="confirmation-content">
            <span class="confirmation-icon">‚úÖ</span>
            <h3 class="confirmation-title">Request Submitted!</h3>
            <p class="confirmation-message" id="confirmationMessage"></p>
            <button class="confirmation-button" id="confirmationButton">OK</button>
        </div>
    </div>
<script>
  const BASE_URL = 'http://13.48.148.22:3078';
const ANNUAL_WFH_LIMIT = 60;
let validationTimeout;

// Define holidays
const holidays = {
    1: { 1: "New Year's Day", 14: "Makar Sankranti", 26: "Republic Day" },
    2: { 14: "Maha Shivaratri" },
    3: { 2: "Holi" },
    4: { 14: "Ram Navami", 18: "Good Friday" },
    8: { 15: "Independence Day", 5: "Krishna Janmashtami", 15: "Ganesh Chaturthi" },
    10: { 2: "Gandhi Jayanti", 20: "Dussehra", 9: "Diwali" },
    12: { 25: "Christmas" }
};

document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('wfhForm');
    const formContainer = document.getElementById('wfhFormContainer');
    const requestsList = document.getElementById('requestsList');
    const wfhSummary = document.getElementById('wfhSummary');
    const confirmationAnimation = document.getElementById('confirmationAnimation');
    const confirmationMessage = document.getElementById('confirmationMessage');
    const confirmationButton = document.getElementById('confirmationButton');
    const calendarDays = document.getElementById('calendarDays');
    const currentMonthYear = document.getElementById('currentMonthYear');
    const prevMonthBtn = document.getElementById('prevMonth');
    const nextMonthBtn = document.getElementById('nextMonth');
    const applyWFH = document.getElementById('applyWFH');
    const detailModal = document.getElementById('detailModal');
    const monthFilter = document.getElementById('monthFilter');
    const yearFilter = document.getElementById('yearFilter');

    let allSubmissions = [];
    let currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();

    init();

    function init() {
        setupEventListeners();
        const empId = document.getElementById('employeeID').value.trim();
        if (empId && /^ATS0(?!000)[0-9]{3}$/.test(empId)) {
            fetchSubmissions(empId);
        } else {
            showNoDataMessage();
        }
        setDateConstraints();
    }

    function showNoDataMessage() {
        requestsList.innerHTML = `
            <div class="no-data">
                <span>üì≠</span>
                <p>Please enter a valid Employee ID to view requests</p>
            </div>`;
        wfhSummary.innerHTML = `
            <div class="no-data">
                <span>üìä</span>
                <p>Enter Employee ID to view summary</p>
            </div>`;
        generateCalendar();
    }

    function setDateConstraints() {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const oneYearFromToday = new Date(today);
        oneYearFromToday.setFullYear(today.getFullYear() + 1);
        const fromDateInput = document.getElementById('fromDate');
        const toDateInput = document.getElementById('toDate');
        fromDateInput.min = formatDate(today);
        fromDateInput.max = formatDate(oneYearFromToday);
        toDateInput.min = formatDate(today);
        toDateInput.max = formatDate(oneYearFromToday);
    }

    function setupEventListeners() {
        applyWFH.addEventListener('click', toggleForm);
        form.addEventListener('submit', handleFormSubmit);
        monthFilter.addEventListener('change', filterRequests);
        yearFilter.addEventListener('change', filterRequests);

        const inputs = [
            { id: 'employeeName', validator: validateEmployeeName },
            { id: 'employeeID', validator: validateEmployeeID },
            { id: 'employeeEmail', validator: validateEmail },
            { id: 'workingProject', validator: validateWorkingProject },
            { id: 'reportingManager', validator: validateReportingManager },
            { id: 'wfhLocation', validator: validateLocation },
            { id: 'reason', validator: validateReason }
        ];

        inputs.forEach(({ id, validator }) => {
            const input = document.getElementById(id);
            input.addEventListener('input', () => {
                clearTimeout(validationTimeout);
                validationTimeout = setTimeout(() => {
                    validator();
                    if (id === 'employeeID' && validateEmployeeID()) {
                        fetchSubmissions(input.value.trim());
                    }
                }, 500);
            });
        });

        const emailInput = document.getElementById('employeeEmail');
        emailInput.addEventListener('keydown', function(e) {
            if (e.key === ' ' || e.key === 'Spacebar' || /\s/.test(e.key)) {
                e.preventDefault();
            }
        });

        emailInput.addEventListener('paste', function(e) {
            e.preventDefault();
            const pastedText = (e.clipboardData || window.clipboardData).getData('text');
            const sanitizedText = pastedText.replace(/\s+/g, '');
            document.execCommand('insertText', false, sanitizedText);
            validateEmail();
        });

        document.getElementById('fromDate').addEventListener('change', validateDates);
        document.getElementById('toDate').addEventListener('change', validateDates);

        confirmationButton.addEventListener('click', () => {
            confirmationAnimation.classList.remove('show');
        });

        prevMonthBtn.addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar();
        });

        nextMonthBtn.addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            generateCalendar();
        });

        const cancelFormBtn = document.getElementById('cancelFormBtn');
        if (cancelFormBtn) {
            cancelFormBtn.addEventListener('click', closeForm);
        }

        const detailModalClose = document.getElementById('detailModalClose');
        if (detailModalClose) {
            detailModalClose.addEventListener('click', () => detailModal.classList.remove('show'));
        }

        const confirmModalClose = document.getElementById('confirmModalClose');
        const cancelSubmitBtn = document.getElementById('cancelSubmitBtn');
        const confirmSubmitBtn = document.getElementById('confirmSubmitBtn');

        if (confirmModalClose) {
            confirmModalClose.addEventListener('click', () => closeModal('confirmModal'));
        }
        if (cancelSubmitBtn) {
            cancelSubmitBtn.addEventListener('click', cancelSubmit);
        }
        if (confirmSubmitBtn) {
            confirmSubmitBtn.addEventListener('click', confirmSubmit);
        }
    }

    function toggleForm() {
        formContainer.classList.toggle('show');
        applyWFH.querySelector('span')?.remove();
        const isOpen = formContainer.classList.contains('show');
        applyWFH.innerHTML = `üè† ${isOpen ? 'Close WFH Form' : 'Apply WFH Request'}`;
        if (!isOpen) {
            form.reset();
            clearErrors();
        }
    }

    function closeForm() {
        formContainer.classList.remove('show');
        applyWFH.innerHTML = `üè† Apply WFH Request`;
        form.reset();
        clearErrors();
    }

    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    function clearErrors() {
        document.querySelectorAll('.error-message').forEach(error => {
            error.textContent = '';
            error.classList.remove('show');
        });
        form.querySelectorAll('input, textarea').forEach(input => {
            input.setCustomValidity('');
        });
    }

    function validateEmployeeName() {
        const name = document.getElementById('employeeName').value;
        const nameRegex = /^[A-Za-z]+(?:\.[A-Za-z]+)*(?: [A-Za-z]+)*(?:\.[A-Za-z]+){0,3}$/;
        const consecutiveSpaces = /\s{2,}/;
        const leadingTrailingSpaces = /^\s+|\s+$/;
        const errorElement = document.getElementById('employeeNameError');

        if (!name) {
            errorElement.textContent = 'Name is required';
            errorElement.classList.add('show');
            return false;
        }

        if (leadingTrailingSpaces.test(name)) {
            errorElement.textContent = 'No leading or trailing spaces allowed';
            errorElement.classList.add('show');
            return false;
        }

        if (consecutiveSpaces.test(name)) {
            errorElement.textContent = 'No consecutive spaces allowed';
            errorElement.classList.add('show');
            return false;
        }

        if (!nameRegex.test(name)) {
            errorElement.textContent = 'Invalid name: Only letters, single spaces, and up to 3 dot-separated suffixes (e.g., John.M.Doe Smith.Jr)';
            errorElement.classList.add('show');
            return false;
        }

        errorElement.classList.remove('show');
        return true;
    }

    function validateEmployeeID() {
        const empId = document.getElementById('employeeID').value.trim();
        const empIdRegex = /^ATS0(?!000)[0-9]{3}$/;
        const errorElement = document.getElementById('employeeIDError');

        if (!empId) {
            errorElement.textContent = 'Employee ID is required';
            errorElement.classList.add('show');
            return false;
        }

        if (!empIdRegex.test(empId)) {
            errorElement.textContent = 'Format: ATS0 followed by 3 digits (not all zeros)';
            errorElement.classList.add('show');
            return false;
        }

        errorElement.classList.remove('show');
        return true;
    }

    function validateEmail() {
        const emailInput = document.getElementById('employeeEmail').value;
        const hasSpaces = /\s/;
        const emailRegex = /^[a-zA-Z][a-zA-Z0-9._-]*[a-zA-Z0-9]@astrolitetech\.com$/;
        const errorElement = document.getElementById('employeeEmailError');

        const sanitizedEmail = emailInput.replace(/\s+/g, '');
        if (emailInput !== sanitizedEmail) {
            document.getElementById('employeeEmail').value = sanitizedEmail;
        }

        if (!sanitizedEmail) {
            errorElement.textContent = 'Email is required';
            errorElement.classList.add('show');
            return false;
        }

        if (hasSpaces.test(emailInput)) {
            errorElement.textContent = 'No spaces allowed in email';
            errorElement.classList.add('show');
            return false;
        }

        if (!emailRegex.test(sanitizedEmail)) {
            errorElement.textContent = 'Email must be in format: firstname.lastname@astrolitetech.com';
            errorElement.classList.add('show');
            return false;
        }

        errorElement.classList.remove('show');
        return true;
    }

    function validateWorkingProject() {
        const project = document.getElementById('workingProject').value;
        const projectRegex = /^[A-Za-z]+(?: [A-Za-z]+)*$/;
        const consecutiveSpaces = /\s{2,}/;
        const leadingTrailingSpaces = /^\s+|\s+$/;
        const errorElement = document.getElementById('workingProjectError');

        if (!project) {
            errorElement.textContent = 'Project name is required';
            errorElement.classList.add('show');
            return false;
        }

        if (leadingTrailingSpaces.test(project)) {
            errorElement.textContent = 'No leading or trailing spaces allowed';
            errorElement.classList.add('show');
            return false;
        }

        if (consecutiveSpaces.test(project)) {
            errorElement.textContent = 'No consecutive spaces allowed';
            errorElement.classList.add('show');
            return false;
        }

        if (project.length < 3 || project.length > 40) {
            errorElement.textContent = 'Project name must be 3-40 characters';
            errorElement.classList.add('show');
            return false;
        }

        if (!projectRegex.test(project)) {
            errorElement.textContent = 'Project name must contain only letters and single spaces';
            errorElement.classList.add('show');
            return false;
        }

        errorElement.classList.remove('show');
        return true;
    }

    function validateReportingManager() {
        const manager = document.getElementById('reportingManager').value;
        const nameRegex = /^[A-Za-z]+(?:\.[A-Za-z]+)*(?: [A-Za-z]+)*(?:\.[A-Za-z]+){0,3}$/;
        const consecutiveSpaces = /\s{2,}/;
        const leadingTrailingSpaces = /^\s+|\s+$/;
        const errorElement = document.getElementById('reportingManagerError');

        if (!manager) {
            errorElement.textContent = 'Manager name is required';
            errorElement.classList.add('show');
            return false;
        }

        if (leadingTrailingSpaces.test(manager)) {
            errorElement.textContent = 'No leading or trailing spaces allowed';
            errorElement.classList.add('show');
            return false;
        }

        if (consecutiveSpaces.test(manager)) {
            errorElement.textContent = 'No consecutive spaces allowed';
            errorElement.classList.add('show');
            return false;
        }

        if (!nameRegex.test(manager)) {
            errorElement.textContent = 'Invalid name: Only letters, single spaces, and up to 3 dot-separated suffixes (e.g., John.M.Doe Smith.Jr)';
            errorElement.classList.add('show');
            return false;
        }

        errorElement.classList.remove('show');
        return true;
    }

    function validateLocation() {
        const location = document.getElementById('wfhLocation').value;
        const locationRegex = /^[A-Za-z]+(?: [A-Za-z]+)*$/;
        const consecutiveSpaces = /\s{2,}/;
        const leadingTrailingSpaces = /^\s+|\s+$/;
        const errorElement = document.getElementById('wfhLocationError');

        if (!location) {
            errorElement.textContent = 'Location is required';
            errorElement.classList.add('show');
            return false;
        }

        if (leadingTrailingSpaces.test(location)) {
            errorElement.textContent = 'No leading or trailing spaces allowed';
            errorElement.classList.add('show');
            return false;
        }

        if (consecutiveSpaces.test(location)) {
            errorElement.textContent = 'No consecutive spaces allowed';
            errorElement.classList.add('show');
            return false;
        }

        if (location.length < 3 || location.length > 100) {
            errorElement.textContent = 'Location must be 3-100 characters';
            errorElement.classList.add('show');
            return false;
        }

        if (!locationRegex.test(location)) {
            errorElement.textContent = 'Location must contain only letters and single spaces';
            errorElement.classList.add('show');
            return false;
        }

        errorElement.classList.remove('show');
        return true;
    }

    function validateReason() {
        const reason = document.getElementById('reason').value;
        const reasonRegex = /^[A-Za-z][A-Za-z0-9\s,.]*[A-Za-z0-9]$/;
        const consecutiveSpaces = /\s{2,}/;
        const leadingTrailingSpaces = /^\s+|\s+$/;
        const invalidConsecutive = /(,{2,}|\.{2,}|,\s,|\.\s\.|,\s\.|\.\s,)/;
        const errorElement = document.getElementById('reasonError');

        if (!reason) {
            errorElement.textContent = 'Reason is required';
            errorElement.classList.add('show');
            return false;
        }

        if (leadingTrailingSpaces.test(reason)) {
            errorElement.textContent = 'No leading or trailing spaces';
            errorElement.classList.add('show');
            return false;
        }

        if (consecutiveSpaces.test(reason)) {
            errorElement.textContent = 'No consecutive spaces allowed';
            errorElement.classList.add('show');
            return false;
        }

        if (reason.length < 10 || reason.length > 200) {
            errorElement.textContent = 'Reason must be 10-200 characters';
            errorElement.classList.add('show');
            return false;
        }

        if (!reasonRegex.test(reason)) {
            errorElement.textContent = 'Reason must start with a letter, end with a letter or number, and only letters, numbers, spaces, commas, periods';
            errorElement.classList.add('show');
            return false;
        }

        if (invalidConsecutive.test(reason)) {
            errorElement.textContent = 'No consecutive commas, periods, or invalid punctuation patterns allowed';
            errorElement.classList.add('show');
            return false;
        }

        errorElement.classList.remove('show');
        return true;
    }

    function validateDates() {
        const fromDateInput = document.getElementById('fromDate');
        const toDateInput = document.getElementById('toDate');
        const fromDate = new Date(fromDateInput.value);
        const toDate = new Date(toDateInput.value);
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const oneYearFromToday = new Date(today);
        oneYearFromToday.setFullYear(today.getFullYear() + 1);
        const maxRangeMs = 60 * 24 * 60 * 60 * 1000;
        const fromError = document.getElementById('fromDateError');
        const toError = document.getElementById('toDateError');
        const empId = document.getElementById('employeeID').value.trim();

        if (!fromDateInput.value) {
            fromError.textContent = 'From date is required';
            fromError.classList.add('show');
            fromDateInput.setCustomValidity('From date is required');
            return false;
        }

        if (fromDate < today || fromDate > oneYearFromToday) {
            fromError.textContent = 'From date must be today or within one year';
            fromError.classList.add('show');
            fromDateInput.setCustomValidity('Invalid date');
            return false;
        }

        fromError.classList.remove('show');
        fromDateInput.setCustomValidity('');

        if (!toDateInput.value) {
            toError.textContent = 'To date is required';
            toError.classList.add('show');
            toDateInput.setCustomValidity('To date is required');
            return false;
        }

        if (toDate < fromDate) {
            toError.textContent = 'To date must be on or after from date';
            toError.classList.add('show');
            toDateInput.setCustomValidity('Invalid date');
            return false;
        }

        const rangeMs = toDate - fromDate;
        if (rangeMs > maxRangeMs) {
            toError.textContent = 'Date range cannot exceed 60 days';
            toError.classList.add('show');
            toDateInput.setCustomValidity('Invalid date');
            return false;
        }

        // Check for date overlaps with existing submissions
        if (empId && allSubmissions.length > 0) {
            const newFrom = new Date(fromDateInput.value);
            const newTo = new Date(toDateInput.value);
            
            for (const sub of allSubmissions) {
                const subFrom = new Date(sub.from_date);
                const subTo = new Date(sub.to_date);
                
                if ((newFrom >= subFrom && newFrom <= subTo) || 
                    (newTo >= subFrom && newTo <= subTo) ||
                    (newFrom <= subFrom && newTo >= subTo)) {
                    
                    fromError.textContent = 'Dates overlap with existing request';
                    fromError.classList.add('show');
                    toError.textContent = 'Dates overlap with existing request';
                    toError.classList.add('show');
                    return false;
                }
            }
        }

        toError.classList.remove('show');
        toDateInput.setCustomValidity('');
        return true;
    }

    async function handleFormSubmit(event) {
        event.preventDefault();

        const validations = [
            validateEmployeeName(),
            validateEmployeeID(),
            validateEmail(),
            validateWorkingProject(),
            validateReportingManager(),
            validateLocation(),
            validateReason(),
            validateDates()
        ];

        if (validations.every(valid => valid)) {
            document.getElementById('confirmModal').style.display = 'flex';
        } else {
            alert('Please correct the form errors before submitting.');
        }
    }

    async function confirmSubmit() {
        closeModal('confirmModal');
        const submitBtn = document.querySelector('#wfhForm button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';

        const fromDate = new Date(document.getElementById('fromDate').value);
        const toDate = new Date(document.getElementById('toDate').value);
        const daysCount = Math.floor((toDate - fromDate) / (1000 * 60 * 60 * 24)) + 1;

const request = {
        name: document.getElementById('employeeName').value.trim(),
        employeeId: document.getElementById('employeeID').value.trim(),
        email: document.getElementById('employeeEmail').value.trim(),
        project: document.getElementById('workingProject').value.trim(),
        manager: document.getElementById('reportingManager').value.trim(),
        location: document.getElementById('wfhLocation').value.trim(),
        fromDate: document.getElementById('fromDate').value,
        toDate: document.getElementById('toDate').value,
        reason: document.getElementById('reason').value.trim(),
        status: 'Pending'
    };

    console.log('Request payload:', request);

        try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 30000);

            const response = await fetch(`${BASE_URL}/api/requests`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                body: JSON.stringify(request),
                signal: controller.signal,
                mode: 'cors'
            });

            clearTimeout(timeoutId);

            let result;
            try {
                result = await response.json();
            } catch (jsonError) {
                console.error('Error parsing JSON response:', jsonError, 'Status:', response.status);
                alert(`Server returned invalid response: ${response.status} ${response.statusText}`);
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úàÔ∏è Submit Request';
                return;
            }

            if (!response.ok) {
                console.error('Server error response:', result, 'Status:', response.status);
                alert(`Server error: ${result.error || 'Failed to submit request'}`);
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úàÔ∏è Submit Request';
                return;
            }

            form.reset();
            closeForm();
            showConfirmation(request.fromDate, request.toDate, daysCount);
            await fetchSubmissions(request.employeeId);

            submitBtn.disabled = false;
            submitBtn.textContent = '‚úàÔ∏è Submit Request';

            setTimeout(() => {
                if (confirmationAnimation.classList.contains('show')) {
                    confirmationAnimation.classList.remove('show');
                }
            }, 5000);

        } catch (error) {
            console.error('Error submitting request:', error);
            submitBtn.disabled = false;
            submitBtn.textContent = '‚úàÔ∏è Submit Request';
            if (error.name === 'AbortError') {
                alert('Error submitting request: Request timed out. Please try again.');
            } else if (error.message.includes('Failed to fetch')) {
                alert('Error submitting request: Unable to connect to server. Check network or server status.');
            } else {
                alert('Error submitting request: ' + error.message);
            }
        }
    }

    function cancelSubmit() {
        closeModal('confirmModal');
    }

    function showConfirmation(fromDate, toDate, daysCount) {
        const from = formatDate(fromDate);
        const to = formatDate(toDate);
        confirmationMessage.textContent = `Your work from home request for ${daysCount} day${daysCount > 1 ? 's' : ''} (${from} to ${to}) has been successfully submitted for approval.`;
        confirmationAnimation.classList.add('show');
        confirmationAnimation.scrollIntoView({ behavior: 'smooth' });
    }

    async function fetchSubmissions(employeeId = '') {
        if (!employeeId || !/^ATS0(?!000)[0-9]{3}$/.test(employeeId)) {
            showNoDataMessage();
            allSubmissions = [];
            generateCalendar();
            return;
        }

        try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 30000);
            const url = new URL(`${BASE_URL}/api/requests`);
            url.searchParams.append('employeeId', employeeId);
            const response = await fetch(url, {
                headers: { 'Accept': 'application/json' },
                signal: controller.signal,
                mode: 'cors'
            });
            clearTimeout(timeoutId);

            let submissions;
            try {
                submissions = await response.json();
            } catch (jsonError) {
                console.error('Error parsing JSON response:', jsonError, 'Status:', response.status);
                throw new Error(`Invalid server response: ${response.status} ${response.statusText}`);
            }

            if (!response.ok) {
                throw new Error(`${submissions.error || 'Server error'}`);
            }

            allSubmissions = submissions;
            filterRequests();
            displaySummary();
            generateCalendar();
        } catch (error) {
            console.error('Error fetching submissions:', error);
            requestsList.innerHTML = `
                <div class="no-data">
                    <span>‚ö†Ô∏è</span>
                    <p>Error loading requests</p>
                </div>`;
            wfhSummary.innerHTML = `
                <div class="no-data">
                    <span>‚ö†Ô∏è</span>
                    <p>Error loading summary</p>
                </div>`;
            allSubmissions = [];
            generateCalendar();
        }
    }

    function filterRequests() {
        const month = monthFilter.value;
        const year = yearFilter.value;

        const filteredSubmissions = allSubmissions.filter(sub => {
            const fromDate = new Date(sub.from_date);
            const matchesMonth = month === '' || fromDate.getMonth() === parseInt(month);
            const matchesYear = year === '' || fromDate.getFullYear() === parseInt(year);
            return matchesMonth && matchesYear;
        });

        displayRequests(filteredSubmissions);
    }

    function displayRequests(submissions) {
        requestsList.innerHTML = '';
        if (submissions.length === 0) {
            requestsList.innerHTML = `
                <div class="no-data">
                    <span>üì≠</span>
                    <p>No requests found</p>
                </div>`;
            return;
        }

        submissions.forEach(sub => {
            const item = document.createElement('div');
            item.className = 'request-item';
            const fromDate = formatDate(sub.from_date);
            const toDate = formatDate(sub.to_date);
            item.innerHTML = `
                <div class="request-header">
                    <div class="request-type">üè† Work From Home</div>
                    <span class="request-status status-${sub.status.toLowerCase()}">${sub.status}</span>
                </div>
                <span class="request-dates">${fromDate} - ${toDate}</span>
                <a href="#" class="view-link">View Details</a>
            `;
            item.querySelector('.view-link').addEventListener('click', (e) => {
                e.preventDefault();
                showRequestDetails(sub);
            });
            requestsList.appendChild(item);
        });
    }

    function showRequestDetails(submission) {
        const detailsContainer = document.getElementById('requestDetails');
        const fromDate = formatDate(submission.from_date);
        const toDate = formatDate(submission.to_date);
        detailsContainer.innerHTML = `
            <h2>Request Details</h2>
            <p><span class="emoji">üë§</span> <strong>Name:</strong> ${submission.name}</p>
            <p><span class="emoji">ü™™</span> <strong>Employee ID:</strong> ${submission.employee_id}</p>
            <p><span class="emoji">üìß</span> <strong>Email:</strong> ${submission.email}</p>
            <p><span class="emoji">üí°</span> <strong>Project:</strong> ${submission.project}</p>
            <p><span class="emoji">üë®‚Äçüíº</span> <strong>Manager:</strong> ${submission.manager}</p>
            <p><span class="emoji">üìç</span> <strong>Location:</strong> ${submission.location}</p>
            <p><span class="emoji">üìÖ</span> <strong>Dates:</strong> ${fromDate} - ${toDate}</p>
            <p><span class="emoji">üí¨</span> <strong>Reason:</strong> ${submission.reason}</p>
            <p><span class="emoji">üîç</span> <strong>Status:</strong> <span class="request-status status-${submission.status.toLowerCase()}">${submission.status}</span></p>
        `;
        detailModal.classList.add('show');
    }

    function displaySummary() {
        const approvedDays = calculateApprovedDays();
        const remainingDays = ANNUAL_WFH_LIMIT - approvedDays;
        wfhSummary.innerHTML = `
            <div class="summary-item">
                <span class="emoji">‚úÖ</span>
                <span>${approvedDays}/${ANNUAL_WFH_LIMIT} Approved WFH Days</span>
            </div>
            <div class="summary-item">
                <span class="emoji">‚è≥</span>
                <span>${remainingDays} Remaining WFH Days</span>
            </div>
        `;
    }

    function calculateApprovedDays() {
        let totalDays = 0;
        const approvedRequests = allSubmissions.filter(sub => sub.status === 'Approved');
        approvedRequests.forEach(sub => {
            const start = new Date(sub.from_date);
            const end = new Date(sub.to_date);
            const days = Math.floor((end - start) / (1000 * 60 * 60 * 24)) + 1;
            totalDays += days;
        });
        return totalDays;
    }

    function generateCalendar() {
        const daysContainer = document.getElementById('calendarDays');
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July',
            'August', 'September', 'October', 'November', 'December'];
        currentMonthYear.textContent = `${monthNames[currentMonth]} ${currentYear}`;

        const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay();
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        const lastDayOfMonth = new Date(currentYear, currentMonth, daysInMonth).getDay();
        const daysInLastMonth = new Date(currentYear, currentMonth, 0).getDate();

        daysContainer.innerHTML = '';

        for (let i = firstDayOfMonth; i > 0; i--) {
            const dayElement = document.createElement('div');
            dayElement.className = 'day other-month';
            dayElement.textContent = daysInLastMonth - i + 1;
            daysContainer.appendChild(dayElement);
        }

        const today = new Date();
        for (let day = 1; day <= daysInMonth; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'day';
            dayElement.textContent = day;

            if (day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
                dayElement.classList.add('today');
                dayElement.setAttribute('data-tooltip', 'Today');
            }
            else if (currentYear === 2025) {
                const monthHolidays = holidays[currentMonth + 1];
                if (monthHolidays && monthHolidays[day]) {
                    dayElement.classList.add('holiday');
                    dayElement.setAttribute('data-tooltip', monthHolidays[day]);
                }
            }

            if (!dayElement.classList.contains('today') && !dayElement.classList.contains('holiday')) {
                const wfhOnThisDay = allSubmissions.find(sub => {
                    const leaveDate = new Date(sub.from_date);
                    const leaveEndDate = new Date(sub.to_date);
                    const currentDate = new Date(currentYear, currentMonth, day);
                    return sub.status === 'Approved' &&
                        currentDate >= leaveDate &&
                        currentDate <= leaveEndDate;
                });

                if (wfhOnThisDay) {
                    dayElement.classList.add('wfh');
                    dayElement.setAttribute('data-tooltip', 'WFH');
                }
            }

            daysContainer.appendChild(dayElement);
        }

        for (let i = 1; i <= (6 - lastDayOfMonth); i++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'day other-month';
            dayElement.textContent = i;
            daysContainer.appendChild(dayElement);
        }
    }

    function formatDate(dateString) {
        const options = { year: 'numeric', month: 'short', day: 'numeric' };
        return new Date(dateString).toLocaleDateString(undefined, options);
    }
});
</script>
</body>
</html>